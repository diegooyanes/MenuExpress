<div class="admin-dashboard">
  <div class="restaurant-header">
    <div>
      <p class="hero-kicker">Menu</p>
      <h1>Menú de <%= @restaurant.name %></h1>
      <p class="text-muted">Sube el menu en PDF o DOC para mostrarlo a tus clientes.</p>
    </div>
    <div class="restaurant-header-actions">
      <%= link_to "Volver", admin_restaurant_path(@restaurant), class: "btn btn-secondary" %>
    </div>
  </div>

  <div class="module-card" id="menu-upload">
    <%= form_with model: [:admin, @restaurant],
                  url: admin_restaurant_path(@restaurant),
                  method: :patch,
                  local: true,
                  html: { multipart: true } do |f| %>
      <div class="form-group">
        <%= f.label :menu_file, "Subir menú (PDF o DOC)" %>
        <div class="file-input">
          <label class="file-label">+ Subir menú</label>
          <%= f.file_field :menu_file,
                           accept: "application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document",
                           class: "file-control" %>
          <span class="file-name">Sin archivo</span>
        </div>
        <small class="text-muted">El archivo reemplaza el menú anterior.</small>
      </div>
      <div class="form-actions">
        <%= f.submit "Guardar menú", class: "btn btn-primary" %>
      </div>
    <% end %>

    <% if @restaurant.menu_file.attached? %>
      <div class="menu-file-card">
        <p class="text-muted">Menú actual:</p>
        <p><strong><%= @restaurant.menu_file.filename.to_s %></strong></p>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary btn-sm" data-modal-open="menu-modal-admin">Ver menú</button>
          <%= link_to "Descargar", url_for(@restaurant.menu_file), class: "btn btn-secondary btn-sm", target: "_blank", rel: "noopener" %>
          <%= button_to "Eliminar", menu_file_admin_restaurant_path(@restaurant),
                        method: :delete,
                        class: "btn btn-danger btn-sm",
                        data: { confirm: "Eliminar el menú actual?" } %>
        </div>
      </div>
    <% else %>
      <p class="empty-message">Aun no hay menú cargado.</p>
    <% end %>
  </div>
</div>

<% if @restaurant.menu_file.attached? %>
  <div class="menu-modal" id="menu-modal-admin" data-modal>
    <div class="menu-modal-backdrop" data-modal-close></div>
    <div class="menu-modal-card">
      <button type="button" class="menu-modal-close" data-modal-close>×</button>
      <h3>Menú</h3>
      <% if @restaurant.menu_file.content_type == "application/pdf" %>
        <iframe src="<%= url_for(@restaurant.menu_file) %>" class="menu-modal-frame"></iframe>
      <% else %>
        <p class="text-muted">Este archivo no se puede previsualizar. Descárgalo para verlo.</p>
        <%= link_to "Descargar menú", url_for(@restaurant.menu_file), class: "btn btn-primary", target: "_blank", rel: "noopener" %>
      <% end %>
    </div>
  </div>
<% end %>
