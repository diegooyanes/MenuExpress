<div class="admin-dashboard">
  <div class="restaurant-header">
    <div>
      <p class="hero-kicker">Reservas</p>
      <h1>Calendario de reservas</h1>
      <p class="text-muted"><%= @restaurant.name %></p>
    </div>
    <div class="restaurant-header-actions">
      <%= link_to "Ver dashboard", admin_restaurant_path(@restaurant), class: "btn btn-secondary" %>
      <%= link_to "Editar informacion", edit_admin_restaurant_path(@restaurant), class: "btn btn-secondary" %>
    </div>
  </div>

  <div class="calendar-toolbar">
    <div class="calendar-view">
      <%= link_to "Semana", admin_restaurant_reservations_path(@restaurant, view: "week"), class: "btn btn-secondary btn-sm #{'is-active' if @calendar_view == 'week'}" %>
      <%= link_to "Mes", admin_restaurant_reservations_path(@restaurant, view: "month"), class: "btn btn-secondary btn-sm #{'is-active' if @calendar_view == 'month'}" %>
    </div>
    <div class="calendar-legend">
      <span class="badge badge-pending">Pendiente</span>
      <span class="badge badge-confirmed">Confirmada</span>
      <span class="badge badge-completed">Completada</span>
      <span class="badge badge-cancelled">Cancelada</span>
    </div>
  </div>

  <div class="calendar-grid">
    <% @calendar_days.each do |day| %>
      <% fully_booked = @fully_booked_days.include?(day) %>
      <div class="calendar-day <%= "is-full" if fully_booked %>">
        <div class="calendar-day-header">
          <strong><%= day.strftime("%a") %></strong>
          <span><%= day.strftime("%d/%m/%Y") %></span>
        </div>
        <div class="calendar-day-body">
          <% if fully_booked %>
            <span class="pill pill-soft">Completo</span>
          <% end %>
          <% daily = @upcoming_reservations.select { |r| r.reservation_date == day } %>
          <% if daily.any? %>
            <% daily.each do |reservation| %>
              <%= link_to admin_restaurant_reservation_path(@restaurant, reservation), class: "reservation-chip status-#{reservation.status}" do %>
                <span><%= reservation.reservation_time.strftime("%H:%M") %></span>
                <strong><%= reservation.full_name %></strong>
                <small><%= reservation.number_of_guests %> pax</small>
              <% end %>
            <% end %>
          <% else %>
            <p class="empty-note">Sin reservas</p>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>

  <div class="module-card">
    <div class="section-header">
      <h2>Lista de proximas reservas</h2>
      <span class="text-muted">Detalles completos disponibles al abrir una reserva.</span>
    </div>
    <% if @upcoming_reservations.any? %>
      <div class="reservations-list compact">
        <% @upcoming_reservations.each do |reservation| %>
          <div class="reservation-card">
            <div class="reservation-header">
              <div class="guest-info">
                <h3><%= reservation.full_name %></h3>
              <p class="meta"><%= reservation.reservation_date.strftime("%d/%m/%Y") %> Â· <%= reservation.reservation_time.strftime("%H:%M") %></p>
              </div>
              <span class="badge badge-<%= reservation.status %>"><%= reservation.status.humanize %></span>
            </div>
            <div class="reservation-actions">
              <%= link_to "Ver detalles", admin_restaurant_reservation_path(@restaurant, reservation), class: "btn btn-secondary btn-sm" %>
              <%= link_to "Cambiar estado", edit_admin_restaurant_reservation_path(@restaurant, reservation), class: "btn btn-primary btn-sm" %>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <p class="empty-message">No hay reservas proximas.</p>
    <% end %>
  </div>
</div>
