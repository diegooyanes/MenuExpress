<div class="admin-dashboard">
  <div class="restaurant-header">
    <div>
      <p class="hero-kicker">Reservas</p>
      <h1>Calendario de reservas</h1>
      <p class="text-muted"><%= @restaurant.name %></p>
    </div>
    <div class="restaurant-header-actions">
      <%= link_to "Ver panel principal", admin_restaurant_path(@restaurant), class: "btn btn-secondary" %>
      <%= link_to "Editar informacion", edit_admin_restaurant_path(@restaurant), class: "btn btn-secondary" %>
    </div>
  </div>

  <div class="calendar-toolbar">
    <div class="calendar-view">
      <%= link_to "Semana", admin_restaurant_reservations_path(@restaurant, view: "week"), class: "btn btn-secondary btn-sm #{'is-active' if @calendar_view == 'week'}" %>
      <%= link_to "Mes", admin_restaurant_reservations_path(@restaurant, view: "month"), class: "btn btn-secondary btn-sm #{'is-active' if @calendar_view == 'month'}" %>
    </div>
    <div class="calendar-legend">
      <span class="badge badge-confirmed">Confirmada</span>
      <span class="badge badge-cancelled">Cancelada</span>
    </div>
  </div>

  <% if @calendar_view == "day" %>
    <div class="module-card">
      <div class="section-header">
        <h2>Reservas del día</h2>
        <span class="text-muted"><%= @calendar_days.first.strftime("%d/%m/%Y") %></span>
      </div>
      <div class="day-toolbar">
        <%= form_with url: admin_restaurant_reservations_path(@restaurant),
                      method: :get,
                      local: true,
                      class: "search-bar-form day-search" do |f| %>
          <%= f.hidden_field :date, value: @calendar_days.first %>
          <%= f.text_field :q, placeholder: "Buscar por nombre", class: "search-bar-input", value: params[:q] %>
        <% end %>
        <%= link_to "Volver al calendario", admin_restaurant_reservations_path(@restaurant), class: "btn btn-primary btn-sm" %>
      </div>
      <% if @day_reservations.any? %>
        <div class="reservations-list compact">
          <% @day_reservations.each do |reservation| %>
            <div class="reservation-card <%= 'is-confirmed' if reservation.display_status_class == 'confirmed' %>">
              <div class="reservation-header">
                <div class="guest-info">
                  <h3><%= reservation.full_name %></h3>
                  <p class="meta"><%= reservation.reservation_time.strftime("%H:%M") %> · <%= reservation.number_of_guests %> personas</p>
                </div>
                <span class="badge badge-<%= reservation.display_status_class %>"><%= reservation.status_label %></span>
              </div>
              <div class="reservation-actions">
                <%= link_to "Ver detalles", admin_restaurant_reservation_path(@restaurant, reservation), class: "btn btn-primary btn-sm" %>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <p class="empty-message">No hay reservas para este día.</p>
      <% end %>
    </div>
  <% else %>
    <div class="calendar-grid">
      <% @calendar_days.each do |day| %>
        <% fully_booked = @fully_booked_days.include?(day) %>
        <div class="calendar-day <%= "is-full" if fully_booked %>">
          <div class="calendar-day-header">
            <strong><%= day.strftime("%a") %></strong>
            <%= link_to day.strftime("%d/%m/%Y"), admin_restaurant_reservations_path(@restaurant, date: day), class: "calendar-day-link" %>
          </div>
          <div class="calendar-day-body">
            <% if fully_booked %>
              <span class="pill pill-soft">Completo</span>
            <% end %>
            <% daily = @upcoming_reservations.select { |r| r.reservation_date == day } %>
            <% if daily.any? %>
              <% daily.first(3).each do |reservation| %>
                <%= link_to admin_restaurant_reservation_path(@restaurant, reservation), class: "reservation-chip status-#{reservation.display_status_class}" do %>
                  <span><%= reservation.reservation_time.strftime("%H:%M") %></span>
                  <strong><%= reservation.full_name %></strong>
                  <small><%= reservation.number_of_guests %> personas</small>
                <% end %>
              <% end %>
              <%= link_to "Ver más",
                          admin_restaurant_reservations_path(@restaurant, date: day),
                          class: "calendar-day-more" %>
            <% else %>
              <p class="empty-note">Sin reservas</p>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
