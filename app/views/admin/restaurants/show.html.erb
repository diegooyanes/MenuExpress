<div class="admin-dashboard">
  <div class="restaurant-header">
    <div>
      <p class="hero-kicker">Restaurante</p>
      <h1><%= @restaurant.name %></h1>
      <p class="text-muted"><%= @restaurant.address.presence || "Direccion pendiente" %></p>
    </div>
  </div>

  <div class="stat-grid">
    <div class="stat-card">
      <h3><%= @upcoming_reservations.count %></h3>
      <p>Reservas proximas</p>
    </div>
    <div class="stat-card">
      <h3><%= @restaurant.reservations.where(status: "cancelled").count %></h3>
      <p>Reservas canceladas</p>
    </div>
    <div class="stat-card">
      <h3><%= @restaurant.view_count.to_i %></h3>
      <p>Número de personas que han visitado tu página</p>
      <% percent = [@restaurant.view_count.to_i, 100].min %>
      <div class="stat-bar">
        <div class="stat-bar-fill" style="width: <%= percent %>%"></div>
      </div>
    </div>
  </div>

  <div class="module-card">
    <h2>Resumen semanal</h2>
    <p class="text-muted">Vista rápida de la última semana.</p>
    <div class="stat-grid">
      <div class="stat-card">
        <h3><%= @weekly_total %></h3>
        <p>Reservas totales</p>
      </div>
      <div class="stat-card">
        <h3><%= @weekly_confirmed %></h3>
        <p>Confirmadas</p>
      </div>
      <div class="stat-card">
        <h3><%= @weekly_cancelled %></h3>
        <p>Canceladas</p>
      </div>
    </div>
  </div>

  <div class="dashboard-grid">
    <div class="module-card">
      <h2>Reservas recientes</h2>
      <p class="text-muted">Listado de reservas y su estado.</p>
      <% if @upcoming_reservations.any? %>
        <div class="review-item">
          <% @upcoming_reservations.each do |reservation| %>
            <div class="review-header">
              <span class="review-author"><%= reservation.full_name %></span>
              <span class="badge badge-<%= reservation.display_status_class %>"><%= reservation.status_label %></span>
            </div>
            <p class="review-text">
              <strong>Fecha:</strong> <%= reservation.reserved_datetime.strftime("%d/%m/%Y %H:%M") %><br>
              <strong>Personas:</strong> <%= reservation.number_of_guests %><br>
              <strong>Teléfono:</strong> <%= reservation.phone_number %>
            </p>
            <hr style="border:0;border-top:1px solid var(--line);margin:12px 0;">
          <% end %>
        </div>
      <% else %>
        <p class="text-muted">No hay reservas próximas.</p>
      <% end %>
    </div>

    <div class="module-card">
      <h2>Perfil del restaurante</h2>
      <p class="text-muted">Mantener la informacion al dia mejora la conversion.</p>
      <div class="info-grid">
        <div>
          <span class="label">Horario</span>
          <p class="value">
            <% if @restaurant.open_time && @restaurant.close_time %>
              <%= @restaurant.open_time.strftime("%H:%M") %> - <%= @restaurant.close_time.strftime("%H:%M") %>
            <% else %>
              N/A
            <% end %>
          </p>
        </div>
        <div>
          <span class="label">Telefono</span>
          <p class="value"><%= @restaurant.phone_number.presence || "N/A" %></p>
        </div>
        <div>
          <span class="label">Aforo maximo</span>
          <p class="value">
            <%= @restaurant.max_capacity.to_i.positive? ? "#{@restaurant.max_capacity} personas" : "N/A" %>
          </p>
        </div>
        <div>
          <span class="label">Reservas</span>
        </div>
      </div>
    </div>

    <div class="module-card">
      <h2>Suscripcion</h2>
      <% latest = @restaurant.subscriptions.order(created_at: :desc).first %>
      <% if latest.present? && latest.status == 'active' %>
        <p class="text-muted">Tu plan esta activo.</p>
        <span class="badge badge-success">Activa</span>
      <% else %>
        <p class="text-muted">Activa la suscripcion para acceder a funciones premium.</p>
        <%= link_to "Activar suscripcion ($15/mes)", new_admin_restaurant_subscription_path(@restaurant), class: "btn btn-primary" %>
      <% end %>
    </div>
  </div>
</div>
